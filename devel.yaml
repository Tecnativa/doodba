version: "2.1"

services:
    odoo10:
        extends:
            file: common.yaml
            service: odoo
        build:
            args:
                # To aggregate in development, use `setup-devel.yaml`
                AGGREGATE: "no"
                # No need for this in development
                PYTHONOPTIMIZE: 0
                PIP_INSTALL_ODOO: "no"
                CLEAN: "no"
                COMPILE: "no"
                # You want demo data for development
                WITHOUT_DEMO: "no"
        ports:
            # XXX I recommend you to use static ports per project
            - "8069"
            - "8072"
        volumes:
            - ./odoo/custom:/opt/odoo/custom:ro,z
        environment:
            PGDATABASE: devel
            # Don't optimize in development
            PYTHONOPTIMIZE: 0
            # XXX Use same static port as in `wdb` service below
            WDB_WEB_PORT: "1984"
        links:
            - db10:db
            - inbox
            - smtp
            - wdb
        # Uncomment to start in unit test mode, add module names if you wish
        # command: unittest module1,module2
        command: odoo --dev all

    db10:
        extends:
            file: common.yaml
            service: db

    inbox:
        extends:
            file: common.yaml
            service: inboxfake

    smtp:
        extends:
            file: common.yaml
            service: smtpfake

    wdb:
        image: yajo/wdb-server
        ports:
            # XXX I recommend you to use static ports per project
            - "1984"

volumes:
    filestore10:
    db10:
